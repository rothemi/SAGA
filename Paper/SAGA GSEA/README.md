# SAGA GSEA

For the implementation of SAGA-GSEA, complete assays were read in batch-wise, quantile-normalized, averaged and log2-transformed within each assay using the R package “limma”. The preprocessed and unfiltered expression matrix with the Agilent ProbeIDs as row names was directly converted into an “epheno” object using the function “ExpressionPhenoTest” from the package “phenoTest” with the phenotype variable (“Group”) set to 1 for all mock samples in each assay and a unique value {2,3,…,n} for each of the samples to be tested against the mock samples. The normalized enrichment score, p-values and fdr were calculated for every sample against the mock samples using the function “gsea” from “phenoTest”. During the leave-one-batch-out procedure, the optimal predictors found by SVM-RFE and SVM-GA for the training set of each iteration were used as geneset for GSEA. The raw data of the left-out test set was read in and preprocessed as described above followed by GSEA. IVIM #171102 was excluded from SAGA-GSEA since it had no mock samples available. The GSEA results were aggregated over the remaining 18 test sets. The ROC curve for SAGA-GSEA and the best NES cutoff were computed using the function “roc” on the normalized enrichment scores and the true class labels with the parameter “threshold” set to “best”, which determines the NES associated with the point farthest to the diagonal line. A vector was assigned to the class “transforming” when its NES was greater than the optimal ROC-cutoff computed on the dataset after exclusion of the strongly transforming LTR.SFFV.eGFP samples (leave one-batch-out: NES>1.3). For the final implementation of SAGA-GSEA to be used in the R-package, the 11 optimal predictors determined on the complete dataset for the final SAGA classifier (see above) are used as geneset. The optimal NES threshold for this geneset was determined by ROC-analysis after performing SAGA-GSEA on the 18 SAGA batches with mock controls available (NES > 1.0). 

## Availability of raw data and R workspace file

*	[SAGA GSEA.RData](https://www.dropbox.com/s/o6i73iixi0u4zay/SAGA%20GSEA.RData?dl=0)
*	[R_SAGA_GSEA_Top11GA_FINAL.R](./R_SAGA_GSEA_Top11GA_FINAL.R)
